<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal AI Models - NeuroLM</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #4f46e5;
            --secondary-color: #4338ca;
            --accent-color: #ff7d4d;
            --dark-bg: #000000;
            --darker-bg: #1a1a1a;
            --card-bg: #2a2a2a;
            --light-text: #ffffff;
            --muted-text: #9ca3af;
            --border-color: #404040;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--dark-bg);
            color: var(--light-text);
            min-height: 100vh;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: var(--dark-bg);
            color: var(--light-text);
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            position: relative;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header h1 {
            font-size: 1.2rem;
            margin: 0;
            color: var(--light-text);
            font-weight: 600;
            display: inline-block;
        }

        .header p {
            opacity: 0.8;
            font-size: 0.7rem;
            color: var(--light-text);
            display: inline-block;
            margin: 0;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-title {
            display: flex;
            flex-direction: column;
        }

        .hamburger-btn {
            background: none;
            border: none;
            color: var(--light-text);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .hamburger-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        .uf-score-badge {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: auto;
            margin-right: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            position: relative;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .uf-score-badge:hover {
            transform: translateY(-1px);
        }

        .uf-score-tooltip {
            position: absolute;
            top: calc(100% + 10px);
            right: 0;
            background: #1f2937;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.8rem;
            line-height: 1.4;
            width: 280px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .uf-score-tooltip::before {
            content: '';
            position: absolute;
            bottom: 100%;
            right: 12px;
            border: 6px solid transparent;
            border-bottom-color: #1f2937;
        }

        .uf-score-badge:hover .uf-score-tooltip {
            opacity: 1;
            pointer-events: auto;
        }

        .tooltip-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #60a5fa;
        }

        .tooltip-rewards {
            margin-top: 8px;
        }

        .tooltip-rewards strong {
            color: #fbbf24;
        }

        .tooltip-rewards ul {
            margin: 4px 0 0 16px;
            padding: 0;
        }

        .tooltip-rewards li {
            margin: 2px 0;
            color: #d1d5db;
        }

        .uf-score-badge .score-label {
            opacity: 0.9;
        }

        .uf-score-badge .score-value {
            font-size: 0.8rem;
        }

        .profile-dropdown {
            position: relative;
        }

        .profile-button {
            background: rgba(31, 41, 55, 0.8);
            border: 1px solid rgba(75, 85, 99, 0.5);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .profile-button:hover {
            background: rgba(31, 41, 55, 1);
            border-color: rgba(75, 85, 99, 0.8);
        }

        .profile-initial {
            color: #ffffff;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .profile-menu {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: rgba(31, 41, 55, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(75, 85, 99, 0.5);
            border-radius: 12px;
            padding: 0.5rem 0;
            min-width: 200px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
        }

        .profile-menu.active {
            display: block;
        }

        .profile-info {
            padding: 0.75rem 1rem;
        }

        .profile-name {
            color: #ffffff;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .profile-email {
            color: #9ca3af;
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }

        .profile-divider {
            height: 1px;
            background: rgba(75, 85, 99, 0.5);
            margin: 0.5rem 0;
        }

        .profile-menu-item {
            width: 100%;
            background: none;
            border: none;
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
            color: #ffffff;
            font-size: 0.9rem;
            text-align: left;
        }

        .profile-menu-item:hover {
            background: rgba(75, 85, 99, 0.3);
        }

        .profile-menu-icon {
            font-size: 1rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }

        .tabs {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            border-bottom: 2px solid #404040;
        }

        .tab {
            padding: 15px 25px;
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab:hover {
            color: #e5e7eb;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .model-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .model-card {
            background: rgba(42, 42, 42, 0.8);
            border: 1px solid #404040;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .model-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .model-header {
            display: flex;
            justify-content: between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .model-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #e5e7eb;
            margin-bottom: 5px;
        }

        .model-category {
            display: inline-block;
            background: rgba(102, 126, 234, 0.2);
            color: #667eea;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .model-description {
            color: #9ca3af;
            font-size: 0.9rem;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .model-specs {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .spec {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #9ca3af;
            font-size: 0.8rem;
        }

        .spec-icon {
            width: 16px;
            height: 16px;
            fill: #667eea;
        }

        .model-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border: 1px solid #667eea;
        }

        .btn-secondary:hover {
            background: rgba(102, 126, 234, 0.2);
        }

        .btn-danger {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            border: 1px solid #ef4444;
        }

        .btn-danger:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        .btn-success {
            background: rgba(34, 197, 94, 0.1);
            color: #22c55e;
            border: 1px solid #22c55e;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-left: auto;
        }

        .status-pending {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        .status-downloading {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        .status-ready {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        .status-training {
            background: rgba(168, 85, 247, 0.2);
            color: #a855f7;
        }

        .status-error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 2px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }

        .setup-recommendations {
            background: rgba(42, 42, 42, 0.8);
            border: 1px solid #404040;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .setup-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #e5e7eb;
            margin-bottom: 15px;
        }

        .setup-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .setup-card {
            background: rgba(30, 30, 30, 0.6);
            border: 1px solid #404040;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .setup-card:hover {
            border-color: #667eea;
        }

        .setup-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #e5e7eb;
            margin-bottom: 8px;
        }

        .setup-size {
            color: #9ca3af;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .setup-description {
            color: #9ca3af;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 15px;
        }

        .setup-models {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .setup-model-tag {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            position: relative;
        }

        .expandable-models {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .expandable-models:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: scale(1.05);
        }

        .more-models {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .model-tooltip {
            position: absolute;
            background: rgba(20, 20, 20, 0.95);
            color: #e5e7eb;
            padding: 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            width: 300px;
            z-index: 9999;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid #404040;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            pointer-events: none;
            top: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(10px);
        }

        .model-tooltip.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .model-card:hover .model-tooltip {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .model-card:hover {
            z-index: 1000;
        }

        .tooltip-title {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 8px;
        }

        .tooltip-section {
            margin-bottom: 10px;
        }

        .tooltip-label {
            font-weight: 500;
            color: #9ca3af;
            font-size: 0.8rem;
        }

        .tooltip-value {
            color: #e5e7eb;
            font-size: 0.9rem;
        }

        .tooltip-pros {
            color: #22c55e;
        }

        .tooltip-cons {
            color: #ef4444;
        }

        .model-tag-with-tooltip {
            position: relative;
        }

        .setup-tooltip {
            position: absolute;
            background: rgba(20, 20, 20, 0.95);
            color: #e5e7eb;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            width: 280px;
            z-index: 9999;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid #404040;
            opacity: 0;
            transform: translateX(-50%) translateY(10px);
            transition: all 0.3s ease;
            pointer-events: none;
            top: 100%;
            left: 50%;
            margin-top: 5px;
        }

        .model-tag-with-tooltip:hover .setup-tooltip {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .model-tag-with-tooltip:hover {
            z-index: 1000;
        }

        /* Header Navigation Styles - Exact match with main chat */
        .header {
            background: var(--dark-bg);
            color: var(--light-text);
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            position: relative;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header h1 {
            font-size: 1.2rem;
            margin: 0;
            color: var(--light-text);
            font-weight: 600;
            display: inline-block;
        }

        .header p {
            opacity: 0.8;
            font-size: 0.7rem;
            color: var(--light-text);
            display: inline-block;
            margin: 0;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-title {
            display: flex;
            flex-direction: column;
        }

        .hamburger-btn {
            background: none;
            border: none;
            color: var(--light-text);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .hamburger-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        .uf-score-badge {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: auto;
            margin-right: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            position: relative;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .uf-score-badge:hover {
            transform: translateY(-1px);
        }

        .uf-score-tooltip {
            position: absolute;
            top: calc(100% + 10px);
            right: 0;
            background: #1f2937;
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 0.8rem;
            width: 250px;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }

        .uf-score-badge:hover .uf-score-tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .tooltip-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #3b82f6;
        }

        .tooltip-rewards {
            margin-top: 10px;
            font-size: 0.75rem;
        }

        .tooltip-rewards ul {
            margin: 5px 0;
            padding-left: 15px;
        }

        .tooltip-rewards li {
            margin: 2px 0;
        }

        .profile-dropdown {
            position: relative;
        }

        .profile-button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .profile-button:hover {
            background: rgba(255,255,255,0.1);
        }

        .profile-initial {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .profile-menu {
            position: absolute;
            top: calc(100% + 10px);
            right: 0;
            background: #2a2a2a;
            border: 1px solid #404040;
            border-radius: 8px;
            padding: 0.5rem 0;
            min-width: 200px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: none;
        }

        .profile-menu.active {
            display: block;
        }

        .profile-info {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #404040;
        }

        .profile-name {
            font-weight: 600;
            color: #e5e7eb;
            margin-bottom: 0.25rem;
        }

        .profile-email {
            font-size: 0.8rem;
            color: #9ca3af;
        }

        .profile-divider {
            height: 1px;
            background: #404040;
            margin: 0.5rem 0;
        }

        .profile-menu-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: none;
            border: none;
            color: #e5e7eb;
            cursor: pointer;
            transition: background 0.2s;
            width: 100%;
            text-align: left;
            font-size: 0.9rem;
        }

        .profile-menu-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .profile-menu-icon {
            font-size: 1rem;
        }

        .page-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .page-header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: #e5e7eb;
        }

        .page-header p {
            color: #9ca3af;
            font-size: 1.1rem;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #9ca3af;
        }

        .spinner {
            border: 3px solid rgba(102, 126, 234, 0.1);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .training-jobs {
            background: rgba(42, 42, 42, 0.8);
            border: 1px solid #404040;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .job-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(30, 30, 30, 0.6);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .job-info {
            flex: 1;
        }

        .job-name {
            font-weight: 600;
            color: #e5e7eb;
            margin-bottom: 5px;
        }

        .job-details {
            color: #9ca3af;
            font-size: 0.9rem;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        /* Model and file search styles */
        .model-search-container, .file-search-container {
            position: relative;
            display: inline-block;
        }

        .model-search-container input, .file-search-container input {
            background: rgba(42, 42, 42, 0.8);
            border: 1px solid #404040;
            border-radius: 4px;
            color: var(--light-text);
            padding: 0.2rem 0.5rem;
        }

        .model-search-container input:focus, .file-search-container input:focus {
            outline: none;
            border-color: #667eea;
        }

        .model-dropdown, .file-dropdown {
            display: none;
        }

        @media (max-width: 768px) {
            .model-grid {
                grid-template-columns: 1fr;
            }
            
            .setup-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .tab {
                padding: 10px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <button id="sidebarToggle" class="hamburger-btn">☰</button>
            <div class="header-title">
                <h1 onclick="showWelcomeScreen()" style="cursor: pointer;">NeuroLM Chat</h1>
                <p>AI chat with integrated memory system</p>
            </div>
        </div>
        
        <div style="margin-left: 1rem; display: inline-block;">
            <label for="modelSearch" style="margin-right: 0.3rem; font-size: 0.7rem;">Model:</label>
            <div class="model-search-container" style="display: inline-block;">
                <input type="text" id="modelSearch" placeholder="Choose AI" readonly style="min-width: 150px; font-size: 0.8rem; padding: 0.2rem;">
                <div class="model-dropdown" id="modelDropdown"></div>
            </div>
        </div>
        
        <div style="margin-left: 1rem; display: inline-block;">
            <label for="fileSearch" style="margin-right: 0.3rem; font-size: 0.7rem;">Files:</label>
            <div class="file-search-container" style="display: inline-block;">
                <input type="text" id="fileSearch" placeholder="Search files..." readonly style="min-width: 150px; font-size: 0.8rem; padding: 0.2rem;">
                <div class="file-dropdown" id="fileDropdown"></div>
            </div>
        </div>
        
        <div class="uf-score-badge" id="ufScoreBadge">
            <span class="score-label">UF Score:</span>
            <span class="score-value" id="ufScoreValue">0</span>
            <div class="uf-score-tooltip">
                <div class="tooltip-title">User Feedback Score</div>
                <div>Earn UF Score points by providing feedback on AI responses. Your feedback helps improve the system and deliver better results.</div>
                <div class="tooltip-rewards">
                    <strong>Upcoming rewards:</strong>
                    <ul>
                        <li>Cryptocurrency rewards</li>
                        <li>Higher rate limits</li>
                        <li>Early access to new features</li>
                        <li>Exclusive premium capabilities</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="profile-dropdown">
            <button class="profile-button" id="profileButton">
                <span class="profile-initial" id="profileInitial">U</span>
            </button>
            <div class="profile-menu" id="profileMenu">
                <div class="profile-info">
                    <div class="profile-name" id="profileName">User</div>
                    <div class="profile-email" id="profileEmail">user@example.com</div>
                </div>
                <div class="profile-divider"></div>
                <button class="profile-menu-item" id="profileKeysBtn">
                    <span class="profile-menu-icon">🔑</span>
                    <span>API Keys</span>
                </button>
                <button class="profile-menu-item" onclick="window.location.href='/personal-models'">
                    <span class="profile-menu-icon">🤖</span>
                    <span>Personal AI Models</span>
                </button>
                <button class="profile-menu-item" onclick="window.location.href='/training'">
                    <span class="profile-menu-icon">🎓</span>
                    <span>Training</span>
                </button>
                <button class="profile-menu-item" id="profileCreditsBtn">
                    <span class="profile-menu-icon">💰</span>
                    <span>Credits</span>
                </button>
                <button class="profile-menu-item" id="profileSettingsBtn">
                    <span class="profile-menu-icon">⚙️</span>
                    <span>Settings</span>
                </button>
                <div class="profile-divider"></div>
                <button class="profile-menu-item" id="profileSignOutBtn">
                    <span class="profile-menu-icon">🚪</span>
                    <span>Sign Out</span>
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="page-header">
            <div style="display: flex; align-items: center; justify-content: center; gap: 20px;">
                <img src="/static/ai-models-icon.png" alt="AI Models" style="width: 240px; height: 160px;">
                <div style="text-align: center;">
                    <h1 style="margin: 0;">Personal AI Models</h1>
                    <p style="margin: 10px 0 0 0;">Build your own custom AI assistants trained on your data</p>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" data-tab="available">Available Models</button>
            <button class="tab" data-tab="my-models">My Models</button>
            <button class="tab" data-tab="training">Training Jobs</button>
            <button class="tab" data-tab="analytics">Analytics</button>
        </div>

        <!-- Available Models Tab -->
        <div class="tab-content active" id="available">
            <div class="setup-recommendations">
                <h3 class="setup-title">Recommended Setups</h3>
                <div class="setup-grid">
                    <div class="setup-card">
                        <div class="setup-name">Beginner Setup</div>
                        <div class="setup-size">Total Size: 19.0 GB</div>
                        <div class="setup-description">Perfect for getting started with personal AI</div>
                        <div class="setup-models">
                            <span class="setup-model-tag model-tag-with-tooltip" data-model="llama_3_1_8b">
                                Quick Assistant (Llama 3.1 8B)
                                <div class="setup-tooltip">
                                    <div class="tooltip-title">meta/llama-3.1-8b-instruct</div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Best For:</div>
                                        <div class="tooltip-value">Research, analysis, detailed explanations</div>
                                    </div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Specialties:</div>
                                        <div class="tooltip-value">Academic writing, data interpretation</div>
                                    </div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Context:</div>
                                        <div class="tooltip-value">128,000 tokens</div>
                                    </div>
                                </div>
                            </span>
                            <span class="setup-model-tag model-tag-with-tooltip" data-model="qwen_coder_7b">
                                Multi-Language Expert (Qwen 2.5 7B)
                                <div class="setup-tooltip">
                                    <div class="tooltip-title">qwen/qwen2.5-coder-7b-instruct</div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Best For:</div>
                                        <div class="tooltip-value">Multi-language coding, large codebase analysis</div>
                                    </div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Specialties:</div>
                                        <div class="tooltip-value">92 programming languages, code completion</div>
                                    </div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Context:</div>
                                        <div class="tooltip-value">128,000 tokens</div>
                                    </div>
                                </div>
                            </span>
                        </div>
                        <button class="btn btn-primary" onclick="setupRecommended('beginner')">
                            Install Beginner Setup
                        </button>
                    </div>
                    <div class="setup-card">
                        <div class="setup-name">Developer Setup</div>
                        <div class="setup-size">Total Size: 24.0 GB</div>
                        <div class="setup-description">Comprehensive coding and reasoning capabilities</div>
                        <div class="setup-models">
                            <span class="setup-model-tag model-tag-with-tooltip" data-model="devstral_small">
                                Code Agent Pro (Mistral Devstral 15GB)
                                <div class="setup-tooltip">
                                    <div class="tooltip-title">mistral/devstral-small-1.1</div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Best For:</div>
                                        <div class="tooltip-value">Code analysis, multi-file editing, autonomous coding</div>
                                    </div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Specialties:</div>
                                        <div class="tooltip-value">Python, JavaScript, debugging, refactoring</div>
                                    </div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Context:</div>
                                        <div class="tooltip-value">32,768 tokens</div>
                                    </div>
                                </div>
                            </span>
                            <span class="setup-model-tag model-tag-with-tooltip" data-model="qwen_coder_7b">
                                Multi-Language Expert (Qwen 2.5 7B)
                                <div class="setup-tooltip">
                                    <div class="tooltip-title">qwen/qwen2.5-coder-7b-instruct</div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Best For:</div>
                                        <div class="tooltip-value">Multi-language coding, large codebase analysis</div>
                                    </div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Specialties:</div>
                                        <div class="tooltip-value">92 programming languages, code completion</div>
                                    </div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Context:</div>
                                        <div class="tooltip-value">128,000 tokens</div>
                                    </div>
                                </div>
                            </span>
                            <span class="setup-model-tag model-tag-with-tooltip" data-model="deepseek_r1_8b">
                                Deep Reasoner (DeepSeek R1 8B)
                                <div class="setup-tooltip">
                                    <div class="tooltip-title">deepseek/deepseek-r1-distill-qwen-8b</div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Best For:</div>
                                        <div class="tooltip-value">Complex problem-solving, step-by-step analysis</div>
                                    </div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Specialties:</div>
                                        <div class="tooltip-value">Reasoning, math, logic, chain-of-thought</div>
                                    </div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Context:</div>
                                        <div class="tooltip-value">8,192 tokens</div>
                                    </div>
                                </div>
                            </span>
                        </div>
                        <button class="btn btn-primary" onclick="setupRecommended('developer')">
                            Install Developer Setup
                        </button>
                    </div>
                    <div class="setup-card">
                        <div class="setup-name">Power User Setup</div>
                        <div class="setup-size">Total Size: 49.0 GB</div>
                        <div class="setup-description">Complete personal AI toolkit with all 6 models</div>
                        <div class="setup-models">
                            <span class="setup-model-tag model-tag-with-tooltip" data-model="devstral_small">
                                Mistral Devstral (15GB)
                                <div class="setup-tooltip">
                                    <div class="tooltip-title">mistral/devstral-small-1.1</div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Best For:</div>
                                        <div class="tooltip-value">Code analysis, multi-file editing, autonomous coding</div>
                                    </div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Specialties:</div>
                                        <div class="tooltip-value">Python, JavaScript, debugging, refactoring</div>
                                    </div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Context:</div>
                                        <div class="tooltip-value">32,768 tokens</div>
                                    </div>
                                </div>
                            </span>
                            <span class="setup-model-tag model-tag-with-tooltip" data-model="deepseek_r1_8b">
                                DeepSeek R1 (5GB)
                                <div class="setup-tooltip">
                                    <div class="tooltip-title">deepseek/deepseek-r1-distill-qwen-8b</div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Best For:</div>
                                        <div class="tooltip-value">Complex problem-solving, step-by-step analysis</div>
                                    </div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Specialties:</div>
                                        <div class="tooltip-value">Reasoning, math, logic, chain-of-thought</div>
                                    </div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Context:</div>
                                        <div class="tooltip-value">8,192 tokens</div>
                                    </div>
                                </div>
                            </span>
                            <span class="setup-model-tag model-tag-with-tooltip" data-model="qwen_coder_7b">
                                Qwen 2.5 Coder (4GB)
                                <div class="setup-tooltip">
                                    <div class="tooltip-title">qwen/qwen2.5-coder-7b-instruct</div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Best For:</div>
                                        <div class="tooltip-value">Multi-language coding, large codebase analysis</div>
                                    </div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Specialties:</div>
                                        <div class="tooltip-value">92 programming languages, code completion</div>
                                    </div>
                                    <div class="tooltip-section">
                                        <div class="tooltip-label">Context:</div>
                                        <div class="tooltip-value">128,000 tokens</div>
                                    </div>
                                </div>
                            </span>
                            <span class="setup-model-tag expandable-models" onclick="toggleMoreModels(this)">+ 3 more models</span>
                            <div class="more-models" style="display: none;">
                                <span class="setup-model-tag model-tag-with-tooltip" data-model="llama_3_1_8b">
                                    Llama 3.1 8B (5GB)
                                    <div class="setup-tooltip">
                                        <div class="tooltip-title">meta/llama-3.1-8b-instruct</div>
                                        <div class="tooltip-section">
                                            <div class="tooltip-label">Best For:</div>
                                            <div class="tooltip-value">Research, analysis, detailed explanations</div>
                                        </div>
                                        <div class="tooltip-section">
                                            <div class="tooltip-label">Specialties:</div>
                                            <div class="tooltip-value">Academic writing, data interpretation</div>
                                        </div>
                                        <div class="tooltip-section">
                                            <div class="tooltip-label">Context:</div>
                                            <div class="tooltip-value">128,000 tokens</div>
                                        </div>
                                    </div>
                                </span>
                                <span class="setup-model-tag model-tag-with-tooltip" data-model="deepseek_v3_8b">
                                    DeepSeek V3 8B (5GB)
                                    <div class="setup-tooltip">
                                        <div class="tooltip-title">deepseek/deepseek-v3-8b-instruct</div>
                                        <div class="tooltip-section">
                                            <div class="tooltip-label">Best For:</div>
                                            <div class="tooltip-value">General assistance, balanced workloads</div>
                                        </div>
                                        <div class="tooltip-section">
                                            <div class="tooltip-label">Specialties:</div>
                                            <div class="tooltip-value">Multi-domain knowledge, cost-effective</div>
                                        </div>
                                        <div class="tooltip-section">
                                            <div class="tooltip-label">Context:</div>
                                            <div class="tooltip-value">64,000 tokens</div>
                                        </div>
                                    </div>
                                </span>
                                <span class="setup-model-tag model-tag-with-tooltip" data-model="mistral_small_3">
                                    Mistral Small 3 (15GB)
                                    <div class="setup-tooltip">
                                        <div class="tooltip-title">mistral/mistral-small-3-instruct</div>
                                        <div class="tooltip-section">
                                            <div class="tooltip-label">Best For:</div>
                                            <div class="tooltip-value">Fast responses, everyday conversations</div>
                                        </div>
                                        <div class="tooltip-section">
                                            <div class="tooltip-label">Specialties:</div>
                                            <div class="tooltip-value">Quick problem solving, general knowledge</div>
                                        </div>
                                        <div class="tooltip-section">
                                            <div class="tooltip-label">Context:</div>
                                            <div class="tooltip-value">32,768 tokens</div>
                                        </div>
                                    </div>
                                </span>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="setupRecommended('power_user')">
                            Install All Models
                        </button>
                    </div>
                </div>
            </div>

            <div class="loading" id="available-loading">
                <div class="spinner"></div>
                Loading available models...
            </div>
            
            <div class="model-grid" id="available-models" style="display: none;">
                <!-- Models will be populated here -->
            </div>
        </div>

        <!-- My Models Tab -->
        <div class="tab-content" id="my-models">
            <div class="loading" id="my-models-loading">
                <div class="spinner"></div>
                Loading your models...
            </div>
            
            <div class="model-grid" id="user-models" style="display: none;">
                <!-- User models will be populated here -->
            </div>
            
            <div class="empty-state" id="my-models-empty" style="display: none;">
                <h3>No Personal Models Yet</h3>
                <p>Add your first model from the Available Models tab to get started.</p>
            </div>
        </div>

        <!-- Training Jobs Tab -->
        <div class="tab-content" id="training">
            <div class="loading" id="training-loading">
                <div class="spinner"></div>
                Loading training jobs...
            </div>
            
            <div class="training-jobs" id="training-jobs" style="display: none;">
                <!-- Training jobs will be populated here -->
            </div>
            
            <div class="empty-state" id="training-empty" style="display: none;">
                <h3>No Training Jobs</h3>
                <p>Start training your first personal model to see jobs here.</p>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div class="tab-content" id="analytics">
            <div class="loading" id="analytics-loading">
                <div class="spinner"></div>
                Loading analytics...
            </div>
            
            <div id="analytics-content" style="display: none;">
                <!-- Analytics will be populated here -->
            </div>
        </div>
    </div>

    <script>
        let availableModels = [];
        let userModels = [];
        let trainingJobs = [];

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // Update active tab
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Update active content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tabId).classList.add('active');
                
                // Load content based on tab
                if (tabId === 'available') {
                    loadAvailableModels();
                } else if (tabId === 'my-models') {
                    loadUserModels();
                } else if (tabId === 'training') {
                    loadTrainingJobs();
                } else if (tabId === 'analytics') {
                    loadAnalytics();
                }
            });
        });

        // Load available models
        async function loadAvailableModels() {
            console.log('Loading available models...');
            try {
                const response = await fetch('/api/personal-models/available');
                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Available models data:', data);
                
                availableModels = data.models || [];
                
                document.getElementById('available-loading').style.display = 'none';
                document.getElementById('available-models').style.display = 'grid';
                
                renderAvailableModels();
            } catch (error) {
                console.error('Error loading available models:', error);
                document.getElementById('available-loading').innerHTML = `<div class="spinner"></div>Error loading models: ${error.message}`;
            }
        }

        // Load user models
        async function loadUserModels() {
            console.log('Loading user models...');
            try {
                const response = await fetch('/api/personal-models/user');
                console.log('User models response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('User models data:', data);
                
                userModels = data.models || [];
                
                // Hide loading state
                document.getElementById('my-models-loading').style.display = 'none';
                
                // Always reset display state first
                document.getElementById('user-models').style.display = 'none';
                document.getElementById('my-models-empty').style.display = 'none';
                
                // Clear any existing content
                document.getElementById('user-models').innerHTML = '';
                
                if (userModels.length === 0) {
                    document.getElementById('my-models-empty').style.display = 'block';
                } else {
                    document.getElementById('user-models').style.display = 'grid';
                    renderUserModels();
                }
            } catch (error) {
                console.error('Error loading user models:', error);
                document.getElementById('my-models-loading').innerHTML = `<div class="spinner"></div>Error loading user models: ${error.message}`;
            }
        }

        // Load training jobs
        async function loadTrainingJobs() {
            try {
                const response = await fetch('/api/personal-models/training-jobs');
                const data = await response.json();
                trainingJobs = data.jobs;
                
                document.getElementById('training-loading').style.display = 'none';
                
                if (trainingJobs.length === 0) {
                    document.getElementById('training-empty').style.display = 'block';
                } else {
                    document.getElementById('training-jobs').style.display = 'block';
                    renderTrainingJobs();
                }
            } catch (error) {
                console.error('Error loading training jobs:', error);
            }
        }

        // Load analytics
        async function loadAnalytics() {
            try {
                const response = await fetch('/api/personal-models/analytics');
                const data = await response.json();
                
                document.getElementById('analytics-loading').style.display = 'none';
                document.getElementById('analytics-content').style.display = 'block';
                
                renderAnalytics(data);
            } catch (error) {
                console.error('Error loading analytics:', error);
            }
        }

        // Render available models
        function renderAvailableModels() {
            const container = document.getElementById('available-models');
            container.innerHTML = availableModels.map(model => `
                <div class="model-card" style="position: relative;">
                    <div class="model-header">
                        <div>
                            <div class="model-name">${model.display_name}</div>
                            <div class="model-category">${model.category.replace('_', ' ')}</div>
                        </div>
                    </div>
                    <div class="model-description">${model.description}</div>
                    <div class="model-specs">
                        <div class="spec">
                            <span>💾 ${model.size_gb} GB</span>
                        </div>
                        <div class="spec">
                            <span>⚡ ${model.parameters}</span>
                        </div>
                        <div class="spec">
                            <span>🔧 ${model.hardware_req}</span>
                        </div>
                        <div class="spec">
                            <span>🏠 ${model.model_family}</span>
                        </div>
                    </div>
                    <div class="model-actions">
                        <button class="btn btn-primary" onclick="addModel('${model.id}', '${model.display_name}')">
                            Use Online
                        </button>
                        <button class="btn btn-secondary" onclick="downloadForDesktop('${model.id}', '${model.display_name}')">
                            Download for Desktop
                        </button>
                    </div>
                    <div class="model-tooltip">
                        <div class="tooltip-title">${model.name}</div>
                        <div class="tooltip-section">
                            <div class="tooltip-label">Repository:</div>
                            <div class="tooltip-value">${model.repository}</div>
                        </div>
                        <div class="tooltip-section">
                            <div class="tooltip-label">Context Window:</div>
                            <div class="tooltip-value">${model.context_window.toLocaleString()} tokens</div>
                        </div>
                        <div class="tooltip-section">
                            <div class="tooltip-label">Specialties:</div>
                            <div class="tooltip-value">${model.specialties.join(', ')}</div>
                        </div>
                        <div class="tooltip-section">
                            <div class="tooltip-label">Best For:</div>
                            <div class="tooltip-value">${model.use_cases.join(', ')}</div>
                        </div>
                        <div class="tooltip-section">
                            <div class="tooltip-label tooltip-pros">Pros:</div>
                            <div class="tooltip-value tooltip-pros">${model.pros.join(' • ')}</div>
                        </div>
                        <div class="tooltip-section">
                            <div class="tooltip-label tooltip-cons">Cons:</div>
                            <div class="tooltip-value tooltip-cons">${model.cons.join(' • ')}</div>
                        </div>
                        <div class="tooltip-section">
                            <div class="tooltip-label">License:</div>
                            <div class="tooltip-value">${model.license}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Render user models
        function renderUserModels() {
            const container = document.getElementById('user-models');
            container.innerHTML = userModels.map(model => `
                <div class="model-card" style="position: relative;">
                    <div class="model-header">
                        <div>
                            <div class="model-name">${model.custom_name || model.config.display_name}</div>
                            <div class="model-category">${model.config.category.replace('_', ' ')}</div>
                        </div>
                        <div class="status-badge status-${model.status}">
                            ${model.status}
                        </div>
                    </div>
                    <div class="model-description">${model.config.description}</div>
                    ${model.status === 'downloading' ? `
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${model.download_progress * 100}%"></div>
                        </div>
                    ` : ''}
                    <div class="model-specs">
                        <div class="spec">
                            <span>💾 ${model.config.size_gb} GB</span>
                        </div>
                        <div class="spec">
                            <span>⚡ ${model.config.parameters}</span>
                        </div>
                        <div class="spec">
                            <span>🏠 ${model.config.model_family}</span>
                        </div>
                        <div class="spec">
                            <span>🎯 Usage: ${model.usage_count || 0}</span>
                        </div>
                        ${model.fine_tuned ? `
                            <div class="spec">
                                <span>🔥 Fine-tuned v${model.fine_tune_version}</span>
                            </div>
                        ` : ''}
                    </div>
                    <div class="model-actions">
                        ${model.status === 'ready' && !model.fine_tuned ? `
                            <button class="btn btn-primary" onclick="trainModel('${model.model_id}')">
                                Start Training
                            </button>
                        ` : ''}
                        ${model.status === 'ready' ? `
                            <button class="btn btn-success">
                                Ready to Use
                            </button>
                        ` : ''}
                        <button class="btn btn-danger" onclick="removeModel('${model.model_id}')">
                            Remove
                        </button>
                    </div>
                    <div class="model-tooltip">
                        <div class="tooltip-title">${model.config.name}</div>
                        <div class="tooltip-section">
                            <div class="tooltip-label">Repository:</div>
                            <div class="tooltip-value">${model.config.repository}</div>
                        </div>
                        <div class="tooltip-section">
                            <div class="tooltip-label">Context Window:</div>
                            <div class="tooltip-value">${model.config.context_window.toLocaleString()} tokens</div>
                        </div>
                        <div class="tooltip-section">
                            <div class="tooltip-label">Specialties:</div>
                            <div class="tooltip-value">${model.config.specialties.join(', ')}</div>
                        </div>
                        <div class="tooltip-section">
                            <div class="tooltip-label">Best For:</div>
                            <div class="tooltip-value">${model.config.use_cases.join(', ')}</div>
                        </div>
                        <div class="tooltip-section">
                            <div class="tooltip-label">Status:</div>
                            <div class="tooltip-value">${model.status}</div>
                        </div>
                        ${model.fine_tuned ? `
                            <div class="tooltip-section">
                                <div class="tooltip-label">Fine-tuned:</div>
                                <div class="tooltip-value">Version ${model.fine_tune_version}</div>
                            </div>
                        ` : ''}
                        <div class="tooltip-section">
                            <div class="tooltip-label">License:</div>
                            <div class="tooltip-value">${model.config.license}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Render training jobs
        function renderTrainingJobs() {
            const container = document.getElementById('training-jobs');
            container.innerHTML = `
                <h3 class="setup-title">Training Jobs</h3>
                ${trainingJobs.map(job => `
                    <div class="job-item">
                        <div class="job-info">
                            <div class="job-name">${job.model_name}</div>
                            <div class="job-details">
                                Status: ${job.status} • 
                                Data: ${job.training_data_size} examples • 
                                Created: ${new Date(job.created_at).toLocaleDateString()}
                            </div>
                            ${job.status === 'running' ? `
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${job.progress * 100}%"></div>
                                </div>
                            ` : ''}
                        </div>
                        <div class="status-badge status-${job.status}">
                            ${job.status}
                        </div>
                    </div>
                `).join('')}
            `;
        }

        // Render analytics
        function renderAnalytics(data) {
            const container = document.getElementById('analytics-content');
            container.innerHTML = `
                <div class="setup-recommendations">
                    <h3 class="setup-title">Usage Analytics</h3>
                    ${data.models ? data.models.map(model => `
                        <div class="setup-card">
                            <div class="setup-name">${model.model_id}</div>
                            <div class="setup-description">
                                Total Usage: ${model.total_usage} • 
                                Avg Response Time: ${Math.round(model.avg_response_time)}ms • 
                                Avg Quality: ${model.avg_quality ? model.avg_quality.toFixed(1) : 'N/A'}
                            </div>
                        </div>
                    `).join('') : '<p>No usage data available yet.</p>'}
                </div>
            `;
        }

        // Add model to collection
        async function addModel(modelId, customName) {
            try {
                const response = await fetch('/api/personal-models/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model_id: modelId,
                        custom_name: customName
                    })
                });
                
                const result = await response.json();
                
                if (result.error) {
                    alert(result.error);
                } else {
                    alert('Model added to your collection!');
                    loadUserModels();
                }
            } catch (error) {
                console.error('Error adding model:', error);
                alert('Failed to add model. Please try again.');
            }
        }

        // Download model for desktop app
        async function downloadForDesktop(modelId, modelName) {
            // Check if desktop app is available
            const desktopAppAvailable = await checkDesktopAppAvailability();
            
            if (!desktopAppAvailable) {
                // Show download desktop app dialog
                if (confirm(`To use ${modelName} locally, you need to download the NeuroLM Desktop app.\n\nWould you like to download it now?`)) {
                    window.open('/desktop-app-download', '_blank');
                }
                return;
            }

            // Send model download request to desktop app
            try {
                const response = await fetch('/api/desktop/download-model', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model_id: modelId,
                        model_name: modelName
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(`Starting download of ${modelName} to your desktop app...`);
                } else {
                    alert(`Failed to start download: ${result.error}`);
                }
            } catch (error) {
                console.error('Error requesting desktop download:', error);
                alert('Failed to communicate with desktop app. Please ensure it is running and connected.');
            }
        }

        // Check if desktop app is available
        async function checkDesktopAppAvailability() {
            try {
                const response = await fetch('/api/desktop/status', {
                    method: 'GET'
                });
                
                const result = await response.json();
                return result.connected || false;
            } catch (error) {
                return false;
            }
        }

        // Remove model from collection
        async function removeModel(modelId) {
            if (!confirm('Are you sure you want to remove this model?')) return;
            
            try {
                const response = await fetch(`/api/personal-models/${modelId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.error) {
                    alert(result.error);
                } else {
                    alert('Model removed from your collection!');
                    // Force refresh of the My Models tab
                    loadUserModels();
                    // Ensure we're on the correct tab
                    const currentTab = document.querySelector('.tab.active');
                    if (currentTab && currentTab.getAttribute('data-tab') === 'my-models') {
                        // Add a small delay to ensure the UI updates
                        setTimeout(() => {
                            loadUserModels();
                        }, 100);
                    }
                }
            } catch (error) {
                console.error('Error removing model:', error);
                alert('Failed to remove model. Please try again.');
            }
        }

        // Train model
        async function trainModel(modelId) {
            if (!confirm('Start training this model? This may take 2-6 hours.')) return;
            
            try {
                const response = await fetch(`/api/personal-models/${modelId}/train`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.error) {
                    alert(result.error);
                } else {
                    alert('Training started! Check the Training Jobs tab for progress.');
                    loadTrainingJobs();
                    loadUserModels();
                }
            } catch (error) {
                console.error('Error starting training:', error);
                alert('Failed to start training. Please try again.');
            }
        }

        // Setup recommended configuration
        async function setupRecommended(setupType) {
            if (!confirm(`Install the ${setupType} setup? This will add multiple models to your collection.`)) return;
            
            // This would need to be implemented to add multiple models at once
            alert('Recommended setup installation will be implemented soon!');
        }

        // Toggle more models display
        function toggleMoreModels(element) {
            const moreModels = element.parentElement.querySelector('.more-models');
            const isVisible = moreModels.style.display !== 'none';
            
            if (isVisible) {
                moreModels.style.display = 'none';
                element.textContent = '+ 3 more models';
            } else {
                moreModels.style.display = 'flex';
                element.textContent = '- hide models';
            }
        }

        // Profile menu functionality
        let profileMenuOpen = false;
        
        function initializeProfileMenu() {
            const profileButton = document.getElementById('profileButton');
            const profileMenu = document.getElementById('profileMenu');
            const profileKeysBtn = document.getElementById('profileKeysBtn');
            
            profileButton.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleProfileMenu();
            });
            
            profileKeysBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                closeProfileMenu();
                window.location.href = '/secrets';
            });
            
            // Close profile menu when clicking outside
            document.addEventListener('click', (e) => {
                if (!profileButton.contains(e.target) && !profileMenu.contains(e.target)) {
                    closeProfileMenu();
                }
            });
        }

        function toggleProfileMenu() {
            const profileMenu = document.getElementById('profileMenu');
            profileMenuOpen = !profileMenuOpen;
            if (profileMenuOpen) {
                profileMenu.classList.add('active');
            } else {
                profileMenu.classList.remove('active');
            }
        }

        function closeProfileMenu() {
            const profileMenu = document.getElementById('profileMenu');
            profileMenuOpen = false;
            profileMenu.classList.remove('active');
        }

        // Profile dropdown functionality (alias for compatibility)
        function initializeProfileDropdown() {
            return initializeProfileMenu();
        }

        // Load user profile information for header
        async function loadUserProfileHeader() {
            try {
                const response = await fetch('/api/user/name');
                if (response.ok) {
                    const data = await response.json();
                    const firstName = data.first_name || 'User';
                    const initial = firstName.charAt(0).toUpperCase();
                    
                    document.getElementById('profileInitial').textContent = initial;
                    document.getElementById('profileName').textContent = firstName;
                    
                    // Set email to 'NeuroLM User' to match main chat
                    const emailElement = document.getElementById('profileEmail');
                    emailElement.textContent = 'NeuroLM User';
                    
                    // Update UF Score badge
                    const ufScoreValue = document.getElementById('ufScoreValue');
                    if (ufScoreValue && data.feedback_score !== undefined) {
                        ufScoreValue.textContent = data.feedback_score;
                    }
                }
            } catch (error) {
                console.error('Error loading user profile:', error);
            }
        }

        // Load user session data (alias for compatibility)
        async function loadUserSession() {
            return await loadUserProfileHeader();
        }

        // Add profile button handlers like in main chat
        function addProfileButtonHandlers() {
            // Handler for API Keys is already added in initializeProfileMenu
            
            const creditsBtn = document.getElementById('profileCreditsBtn');
            if (creditsBtn) {
                creditsBtn.addEventListener('click', function() {
                    // Credits functionality
                    console.log('Credits clicked');
                });
            }
            
            const settingsBtn = document.getElementById('profileSettingsBtn');
            if (settingsBtn) {
                settingsBtn.addEventListener('click', function() {
                    // Settings functionality
                    console.log('Settings clicked');
                });
            }
        }

        // Logout function
        function logout() {
            fetch('/logout', { method: 'POST' })
                .then(() => {
                    window.location.href = '/login';
                })
                .catch(error => {
                    console.error('Logout error:', error);
                    window.location.href = '/login';
                });
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeProfileMenu();
            addProfileButtonHandlers();
            loadAvailableModels();
        });
        
        // Load profile immediately like chat.html
        loadUserProfileHeader();
        
        // Header functionality - showWelcomeScreen to navigate back to main chat
        function showWelcomeScreen() {
            window.location.href = '/';
        }
    </script>
</body>
</html>